<div th:fragment="signature">
    <p><strong>By my signature I attest that the information I am<br>providing is accurate and truthful.</strong></p>
    <div class="form-group">
        <label>Signature</label>
        <div class="sigPad">
            <ul class="sigNav nav">
                <li class="nav-item">
                    <a href="#" class="nav-link active" aria-label="Draw It">Draw It</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" aria-label="Type It">Type It</a>
                </li>
            </ul>
            <div class="sigWrapper">
                <!-- Asignar un id al canvas para que pueda ser seleccionado por el script -->
                <canvas id="signatureCanvas" class="pad" data-fieldid="27" data-fieldname="signature" width="396" height="150" style="touch-action: none; user-select: none; visibility: visible;"></canvas>
            </div>
            <button type="button" class="btn btn-sm btn-danger mt-2" id="clearSignature">Clear</button>
            <input type="hidden" name="signatureData" th:value="${signatureData}">
        </div>
    </div>
    <style>
        .sigWrapper {
            border: 1px solid #cccccc;
            height: 150px;
            max-width: 400px;
        }

        .sigPad {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        canvas {
            touch-action: none;
            user-select: none;
        }
    </style>
</div>


<script>
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    const clearButton = document.getElementById('clearSignature');
    let drawing = false;

    // Ajusta el tamaño del canvas para evitar pixelación
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    // Eventos para mouse
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mousemove', draw);

    // Eventos para touch (dispositivos móviles)
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchend', stopDrawing);
    canvas.addEventListener('touchmove', draw);

    // Función para comenzar a dibujar
    function startDrawing(event) {
        drawing = true;
        ctx.beginPath();
        const {offsetX, offsetY} = getEventCoordinates(event);
        ctx.moveTo(offsetX, offsetY);
        event.preventDefault(); // Evitar scroll en móviles
    }

    // Función para detener el dibujo
    function stopDrawing() {
        drawing = false;
        ctx.closePath();
    }

    // Función para dibujar en el canvas
    function draw(event) {
        if (!drawing) return;

        const {offsetX, offsetY} = getEventCoordinates(event);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
        ctx.lineTo(offsetX, offsetY);
        ctx.stroke();

        event.preventDefault(); // Evitar scroll en móviles
    }

    // Función para obtener las coordenadas del evento (mouse o touch)
    function getEventCoordinates(event) {
        if (event.touches) {
            const touch = event.touches[0];
            const rect = canvas.getBoundingClientRect();
            return {
                offsetX: touch.clientX - rect.left,
                offsetY: touch.clientY - rect.top
            };
        } else {
            return {
                offsetX: event.offsetX,
                offsetY: event.offsetY
            };
        }
    }

    // Función para limpiar el canvas
    clearButton.addEventListener('click', function () {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    });
</script>